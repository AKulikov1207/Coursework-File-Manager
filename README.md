# Разработка файлового менеджера (аналогично Windows Commander, Far). 
## Разработать функции: 
* выбора дисков; 
* создания, перемещения, удаления каталогов (папок);
* создания, перемещения, удаления файлов; 
* отображения свободного дискового пространства, информации о файлах; 
* удаления временных ненужных файлов; 
* форматирования дисков; 
* поиска файлов. 
Реализовать обработку исключительных ситуаций.

В данном проекте разработан файловый менеджер для операционных систем семейства Microsoft Windows, в котором реализованы базовые операции с файлами и папками: открытие, перемещение, копирование, удаление, помещение в корзину, создание каталогов, форматирование, поиск файлов, выбор устройств памяти/дисков.
Интерфейс программы был сделан по возможности наиболее интуитивно понятным и эргономичным.
Курсовой проект (получивший рабочее название MyCommander) выполнен в системе визуального программирования Embarcadero C++ Builder, с использованием библиотеки визуальных компонентов (VCL) и функций Windows API.
Проект MyCommander’а состоит, помимо файлов, создаваемых средой разработки автоматически, из четырех модулей (Unit1.cpp, Unit2.cpp, Unit3.cpp и Unit4. cpp).
* В заголовочном файле первого модуля (Unit1), находится описание главной формы программы, создаваемой при ее запуске, в теле этого модуля находятся исходные тексты обработчиков событий, порождаемых теми или иными действиями пользователя в главной форме программы (Form1).
* Во втором модуле (Unit2) описаны все функции, на вызове которых строится работа программы, кроме функций-обработчиков событий. В хедере этого модуля объявлены глобальные константы и переменные, а также находятся прототипы функций, вызываемых из других модулей.
* В третьем модуле (Unit3) находится описание и функции-обработчики событий для формы (FormDialogCreateDir), являющейся диалоговым окном создания новой директории.
* В четвертом модуле (Unit4) находится описание и функции-обработчики событий для формы (FormDialogDelete), являющейся диалоговым окном удаления или помещения в корзину.

## Формы программы
### 1. Главная форма программы
1.1 При запуске программы создается главная форма Form1 – представитель класса TForm (рис.1). При создании формы создаются списки доступных устройств, отображаемые в FileListLeft и FileListRight, в обеих панелях отображается корневая директория диска C:\, поскольку мной было сделано предположение, что этот логический диск должен быть практически на всех компьютерах, так же создается множество атрибутов директории DirAttribSet, используемое функциями второго модуля.
В Form1 реализовано одно событие: Create (создание, функция-обработчик: FormCreate).
Опишем объекты, расположенные на Form1.
1.2 FileListLeft и FileListRight – представители класса TStringGrid. Выполняют функцию панелей, куда происходит отображение содержимого директорий и где пользователь выбирает файл (каталог), над которым он собирается выполнять какое-либо действие. Здесь большое значение имеет понятие «активная панель». Роль активной панели играет та таблица, к которой в данный момент обращается пользователь. Все операции совершаются с файлами (каталогами), отображенными в активной панели (копирование и перемещение осуществляется в папку, содержимое который в данный момент отображено в неактивной панели). В программе предусмотрен разный вид для активной и неактивной панелей.
В FileListLeft и FileListRight реализованы следующие события: DblClick (двойной клик мыши, функции-обработчики: FileListLeftDblClick и FileListRightDblClick), Enter (вход, что означает, что панель становится активной, функции-обработчики: FileListLeftEnter и FileListRightEnter), KeyDown («горячие клавиши», функции-обработчики: FileListLeftKeyDown и FileListRightKeyDown).
1.3 ListDevicesLeft и ListDevicesRight – представители класса TComboBox (выпадающий список выбора). Являются списками доступных устройств хранения информации. Выбор пользователем какого-либо устройства из этого списка означает переход к корневой директории этого устройства, которая отображается в соответствующей панели, становящейся при этом активной. В случае, если корневые директории в обеих панелях после выбора совпадают, то в активной панели отображается содержимое той же папки, что и в неактивной.
В ListDevicesLeft и ListDevicesRight реализованы следующие события: Select (выбор пункта в списке, функции-обработчики: ListDevicesLeftSelect и ListDevicesRightSelect), Enter (вход, что означает, что соответствующая панель становится активной, функции-обработчики: FileListLeftEnter и FileListRightEnter).
1.4 bRemove, bCopy, bCreateDir, bDelete, bCurrentRootDirLeft и 
bCurrentRootDirRight, bFormatting, bSearch – представители класса TButton. Кнопки выполняют различные функции. Во всех кнопках реализовано только одно событие – Click (нажатие, функции обработчики: bCreateDirClick, bDeleteClick, bCopyClick, bRemoveClick, bCurrentRootDirLeftClick и bCurrentRootDirRightClick, bFormattingClick, bSearchClick). 
При нажатии на bRemove происходит перемещение файла (каталога, со всеми вложенными каталогами) из папки, отображенной в активной панели, в папку, отображенную в неактивной. Нажатие bCopy практически аналогично нажатию на bRemove. только происходит копирование, а не перемещение. Нажатие на 
bCreateDir выводит диалог создания каталога FormDialogCreateDir. Нажатие на bDelete выводит диалог удаления или помещения в корзину FormDialogDelete. При нажатии на bCurrentRootDirLeft или bCurrentRootDirRight в соответствующих панелях происходит отображение корневой директории текущего устройства хранения информации. При нажатии на bFormatting происходит форматирование диска. При нажатии на bSearch происходит поиск файла.
1.5 LabelCurrentPathLeft и LabelCurrentPathRight - представители класса TLabel.
В этих объектах отображаются текущие пути панелей.
1.6 LabelFormatting - представитель класса TLabel. Отображается название раздела «Форматирование».
1.7 LabeledEditSearch - представитель класса TLabeledEdit. Используется для ввода имени файла, который нужно найти.
1.8 QuickFormatting и StandardFormatting - представители класса TCheckBox. Используются для выбора вида форматирования диска.

рис.1 – Внешний вид Form1.

### 2. Диалог создания каталога
2.1 При нажатии на кнопку формы Form1 bCreateDir на экран выводится форма FormDialogCreateDir – представитель класса TForm (рис.2).
Опишем объекты расположенные на FormDialogCreateDir.
2.2 edNewDirName – представитель класса TEdit. Поле, куда пользователь вводит имя нового каталога. В edNewDirName реализовано событие KeyDown («горячие клавиши», функция-обработчик edNewDirNameKeyDown).
2.3 Label1 – представитель класса TLabel. Содержит надпись «Создать каталог:».
2.4 bOk и bCancel – представители класса TButton. В bOk и bCancel реализовано одно событие: Click (нажатие, функции-обработчики: bOkClick и bCancelClick). При нажатии на bOk, если введенное имя правильное (т.е. не содержит зарезервированных символов и слов и не совпадает с именем каталога в активной панели) или нет других ошибок (например, нет прав доступа), создается каталог в папке, отображенной в активной панели, и форма скрывается, в противном случае выдается сообщение об ошибке и предлагается повторить ввод. При нажатии на bCancel форма скрывается без выполнения каких-либо других действий.

рис.2 – Внешний вид FormDialogCreateDir.

### 3. Диалог создания удаления или перемещения в корзину
3.1 При нажатии на кнопку формы Form1 bDelete на экран выводится форма FormDialogDelete – представитель класса TForm (рис.3).
Опишем объекты на FormDialogDelete.
3.2 Label1 – представитель класса TLabel. Содержит надпись «Выберете действие:».
3.3 bDelete, bCancel, bRecycler – представители класса TButton. В bDelete, bCancel, bRecycler реализовано одно событие: Click (нажатие, функции-обработчики: bDeleteClick, bCancelClick и bRecyclerClick). При нажатии на bDelete файл (каталог), находящийся в фокусе в активной панели, удаляется. При нажатии на bRecycler, файл (каталог), находящийся в фокусе в активной панели, помещается в корзину. При нажатии на bCancel форма скрывается без выполнения каких-либо других действий.
 
рис.3 – Внешний вид FormDialogDelete.

## Работа программы
### 1. Принцип работы программы
При запуске программы создается главная форма, затем приложение ожидает действия пользователя. Каждому предусмотренному действию сопоставлена функция-обработчик.
При нажатии на кнопки «Удалить» или «Создать каталог» программа выводит на экран соответствующие диалоговые окна, где так же есть предусмотренные действия пользователя с объектами на этих формах.
После выполнения какого-либо действия, программа возвращается в режим ожидания пользовательских действий.
Для завершения работы с MyCommander пользователю достаточно нажать на кнопку «Закрыть» системного меню, находящуюся в правом верхнем углу окна программы.
Все функции-обработчики событий во всех формах вызывают функции реализации операций из второго модуля программы.
Но для начала опишем используемые в программе глобальные переменные и константы.

### 2. Глобальные переменные и константы
2.1 Глобальные константы.
Все глобальные константы объявлены в программе с помощью директивы define. LEFT=1 и RIGHT=0 – используется для обозначения панели, над которой производятся действия.
FO_DELETER=5 используется в Delete для выбора действия «помещение в корзину».

2.2 Глобальные переменные.
DirSel изменяет значение, когда в LitsDevicesLeft (ListDevicesRight) происходит выбор устройства либо происходит нажатие на bCurrentRootDirLeft (bCurrentRootDirRight). Используется для передачи в HandlerOfOpen.
RootDirLeft и RootDirRight – текущий путь корневой директории. Используется для передачи в HandlerOfOpen.
CurrentPathLeft, CurrentPathRight – текущий путь. Возвращается HandlerOfOpen. Используется для передачи в Delete, CreateFolder, CopyOrRemove.
Panel – принимает только два значения: LEFT и RIGHT. Используется для указания активной панели.

### 3. Функции реализации операций
3.1 CreateListOfDevices.
Создает список корневых директорий доступных устройств хранения информации и отображает этот список в ListDevicesLeft и ListDevicesRight.
Функции не передаются параметры. Не возвращает значения.
Используется функция Windows API GetDriveType.

3.2 ScanDir.
Функции предается строка, заканчивающаяся нулем (const char *Path), содержащая путь к директории, в которой производится поиск всех содержащихся в ней папок и файлов и переменная (int Panel), в зависимости от значения которой формируется либо DequeFindLeft (если Panel=LEFT) или DequeFindRight (если Panel=RIGHT).
Используются три функции Windows API: FindFirstFile, FindNextFile, FindClose.
Вызывается в ViewDirectory.
DequeFindLeft (DequeFindRight) – это контейнер библиотеки стандартных шаблонов, являющийся очередью deque, элементами которой являются структуры типа WIN32_FIND_DATAA. Тип WIN32_FIND_DATAA описан в winbase.h. Ссылка на структуру передается в FindFirstFile и FindNextFile.

3.3 StrucFindToFileProp.
Преобразует структуру типа WIN32_FIND_DATAA в _FileProperty.
Функции передается структура типа WIN32_FIND_DATAA и ссылка на структуру типа _FileProperty. Не возвращает значения.
Вызывается в ViewDirectory.
Тип _FileProperty описывается в начале модуля и используется для отображения результатов работы ScanDir в FileListLeft (FileListRight), т.к. некоторые поля WIN32_FIND_DATAA не адаптированы для вывода. 

3.4 ViewDirectory.
Отображает содержимое папки, путь к которой передается в const char *Path в активной панели.
Функции предается строка, заканчивающаяся нулем (const char *Path), содержащая путь, который передается в ScanDir, и переменная (int Panel), передаваемая в ScanDir, и в зависимости от значения которой, результаты отображаются в FileListLeft (если Panel=LEFT) или FileListRight (если Panel=RIGHT). Не возвращает значения.
Вызывается в HandlerOfOpen, CreateFolder, CopyOrRemove и Deleting.

3.5 HandlerOfOpen.
В зависимости от действий пользователя, выполняет различные операции. Если происходит выбор в ListDevicesLeft (ListDevicesRight), то отображается корневая директория, выбранного устройства при условии, что корневые директории панелей не совпадают, иначе в активной панели отображается открытая папка неактивной панели. Если происходит нажатие на bCurrentRootDirLeft (bCurrentRootDirRight), то отображается корневая директория текущего устройства. Если происходит двойной клик (нажатие клавиши Enter) по FileListLeft (FileListRight), то анализируется, какая строка находится сейчас в фокусе, и в зависимости от содержимого, выполняются различные операции. Если в фокусе находится файл, то он открывается приложением, с которым ассоциирован либо, если это приложение, производится его запуск. Если в фокусе находится папка, то отображается ее содержимое. Все действия совершаются с активной панелью.
Функции передается строка, путь к корневой директории устройства (AnsiString RootDir), активная панель (int Panel) и признак смены корневой директории (int DirSel). Возвращает текущий путь активной директории.
Используется функция Windows API ShellExecuteA.

3.6 CreateFolder.
Создает директорию в активной панели.
Функции передается указание на то, какая сейчас панель активна (int Panel). Возвращает значение типа bool, в зависимости от результатов выполнения операции. Функция создает каталог в пути панели, являющейся активной. В качестве текущего пути в каждой панели используются значения соответствующих глобальных переменных.
Используются функции Windows API: CreateDirectory и MessageBoxA.

3.7 Deleting.
Удаляет или помещает в корзину объект (файл или папку, со всеми ее вложенными папками), находящийся в фокусе в активной панели.
В функцию передается признак активной панели (int Panel) и операция (int Operation), которую надо совершить, т.е. удалить или поместить в корзину. Не возвращает значения.
Используется функция Windows API: SHFileOperation.

3.8 CopyOrRemove.
Перемещает или копирует объект (файл или папку, со всеми ее вложенными папками), находящийся в фокусе в активной панели в папку неактивной панели.
В функцию передается признак активной панели (int Panel) и операция (int Operation), которую надо совершить, т.е. копировать или переместить. Не возвращает значения.
Используется функция Windows API: SHFileOperation.

3.9 Formatting.
Форматирует диск.
В функцию передается тип форматирования (int type), в зависимости от которого происходит быстрое или стандартное форматирование. Не возвращает значения.
Используется функция Windows API: SHFormatDrive.

3.10 Searching.
Поиск файла, имя которого находится в поле ввода. 
Функции передаются строки, путь к корневой директории устройства (AnsiString path), имя файла (AnsiString name). Поиск происходит по всей файловой системе диска. Если на пути встречается каталог, происходит рекурсивный вызов этой функции. Не возвращает значения.
Используются функции Windows API: FindFirst, FindNext, FindClose.

## Описание использованных средств языка программирования
#include <vcl.h>
Библиотека визуальных компонентов для разработки приложений и пользовательских интерфейсов для Microsoft Windows.
#include <winbase.h>
Этот модуль определяет 32-разрядные базовые API Windows
#include <stdlib.h>
 Заголовочный файл стандартной библиотеки языка Си, который содержит в себе функции, занимающиеся выделением памяти, контролем процесса выполнения программы, преобразованием типов и другие.
#include <shellapi.h>
Этот модуль используется системой свойств Windows.
#include <windows.h>
Этот модуль содержит объявления для всех функций в Windows API, все общие макросы, используемые программистами Windows, и все типы данных, используемые различными функциями и подсистемами.
#include <winnt.h>
Различные макросы и типы.
#include <deque>
Определяет шаблон класса контейнера deque и несколько вспомогательных шаблонов.
#include <set>
Определяет шаблоны классов контейнеров set и multiset и их вспомогательные шаблоны.
#include <string>
Определяет шаблон класса контейнера basic_string и различные вспомогательные шаблоны.
#include <Shlobj.h>
Модуль для Windows Controls.
#include <SysUtils.hpp>
В этом модуле определены функционально такие же операции, что и в модуле System, но с большими возможностями.
#include <tchar.h>
Универсальные текстовые сопоставления
int WINAPI _tWinMain (HINSTANCE, HINSTANCE, LPSTR, int) {}
WINAPI – это соглашение о вызове, которое определяет, как функция получает параметры от вызывающего объекта
